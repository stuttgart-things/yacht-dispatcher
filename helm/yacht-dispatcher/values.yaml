namespace: yacht

configmaps:
  yad-configuration:
    YAW_IMAGE: scr.app.sthings.tiab.ssc.sva.de/yacht-application-worker/yacht-application-worker:23.0307.0908
    TEKTON_NAMESPACE: yacht-tekton
    STATUS_TO_ELASTICSEARCH: "TRUE"
    ELASTICSEARCH_URL: http://10.100.136.150:9200
    ELASTICSEARCH_STATUS_INDEX: yacht-worker-status

secrets:
  redis-connection-yd:
    name: redis-connection-yd
    labels:
      app: yacht-dispatcher
    dataType: data
    secretKVs:
      REDIS_SERVER: MTAuMzEuMTAxLjEzOA==
      REDIS_PORT: NjM3OQ==
      REDIS_PASSWORD: QXRsYW43aXM=
      REDIS_QUEUE: cmVkaXNxdWV1ZTp5YWNodC1yZXZpc2lvbnJ1bnM=

deployment:
  name: yacht-dispatcher
  labels:
    app: yacht-dispatcher
  selectorLabels:
    app: yacht-dispatcher
  allowPrivilegeEscalation: "false"
  privileged: "false"
  runAsNonRoot: "false"
  readOnlyRootFilesystem: "true"
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi
  containers:
    yacht-dispatcher:
      image: eu.gcr.io/stuttgart-things/yacht-dispatcher
      replicaCount: 1
      imagePullPolicy: Always
      tag: 23.0522.0850-0.3.8
      secretsEnvFrom:
        - name: hello
      securityContext:
        capabilities: {}
# RBAC
serviceAccounts:
  yacht-dispatcher:
    labels:
      app: yacht-dispatcher
roles:
  yacht-dispatcher:
    labels:
      app: yacht-dispatcher
    rules:
      - apiGroups:
          - ""
        resources:
          - pods
        verbs:
          - get
          - list
          - watch
          - create
      - apiGroups:
          - "batch"
        resources:
          - jobs
        verbs:
          - get
          - list
          - watch
          - create
roleBindings:
  yacht-dispatcher:
    labels:
      app: yacht-dispatcher
    roleRef:
      kind: Role
      name: yacht-dispatcher
      apiGroup: rbac.authorization.k8s.io
    subjects:
      - kind: ServiceAccount
        name: yacht-dispatcher
        namespace: yacht
clusterRoles:
  list-all-namespaces:
    labels:
      app: yacht-dispatcher
    rules:
      - apiGroups:
          - ""
        resources:
          - namespaces
        verbs:
          - get
          - list
      - apiGroups:
          - "batch"
        resources:
          - jobs
        verbs:
          - get
          - list
          - patch
          - watch
          - create
clusterRoleBindings:
  list-all-namespaces-and-jobs-yd:
    roleRef:
      kind: ClusterRole
      name: list-all-namespaces-and-jobs
      apiGroup: rbac.authorization.k8s.io
    subjects:
      - kind: ServiceAccount
        name: yacht-dispatcher
        namespace: yacht
  tekton-pipelines-controller-cluster-access-yd:
    roleRef:
      kind: ClusterRole
      name: tekton-pipelines-controller-cluster-access
      apiGroup: rbac.authorization.k8s.io
    subjects:
      - kind: ServiceAccount
        name: yacht-dispatcher
        namespace: yacht
